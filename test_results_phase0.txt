test_detect_platform_darwin_arm64 (test_bootstrap.BootstrapTests.test_detect_platform_darwin_arm64) ... ok
test_detect_platform_linux_amd64 (test_bootstrap.BootstrapTests.test_detect_platform_linux_amd64) ... ok
test_extract_binary_prefers_cli_proxy_executable (test_bootstrap.BootstrapTests.test_extract_binary_prefers_cli_proxy_executable) ... ok
test_pick_release_asset_prefers_platform_match (test_bootstrap.BootstrapTests.test_pick_release_asset_prefers_platform_match) ... ok
test_prepare_litellm_runner (test_bootstrap.BootstrapTests.test_prepare_litellm_runner) ... ok
test_validate_cliproxy_binary (test_bootstrap.BootstrapTests.test_validate_cliproxy_binary) ... ok
test_validate_litellm_runner_accepts_no_runtime_group_script (test_bootstrap.BootstrapTests.test_validate_litellm_runner_accepts_no_runtime_group_script) ... ok
test_auth_codex_import_headless (test_cli.CLITests.test_auth_codex_import_headless) ... ok
test_auth_codex_import_headless_default_dest_follows_runtime_root (test_cli.CLITests.test_auth_codex_import_headless_default_dest_follows_runtime_root) ... ok
test_auth_import_dispatches_by_registered_method (test_cli.CLITests.test_auth_import_dispatches_by_registered_method) ... ok
test_auth_import_headless_generic_provider_command (test_cli.CLITests.test_auth_import_headless_generic_provider_command) ... ok
test_auth_list_reports_configured_providers_and_headless_support (test_cli.CLITests.test_auth_list_reports_configured_providers_and_headless_support) ... ok
test_auth_login (test_cli.CLITests.test_auth_login) ... ok
test_auth_login_generic_command_unknown_provider (test_cli.CLITests.test_auth_login_generic_command_unknown_provider) ... ok
test_auth_login_generic_provider_command (test_cli.CLITests.test_auth_login_generic_provider_command) ... ok
test_auth_login_timeout_error_contains_hint (test_cli.CLITests.test_auth_login_timeout_error_contains_hint) ... ok
test_auth_status_reports_provider_capabilities (test_cli.CLITests.test_auth_status_reports_provider_capabilities) ... ok
test_bootstrap_download (test_cli.CLITests.test_bootstrap_download) ... ok
test_bootstrap_download_rejects_litellm_version_flag (test_cli.CLITests.test_bootstrap_download_rejects_litellm_version_flag) ... usage: flowgate [-h] [--config CONFIG]
                {profile,status,health,doctor,integration,auth,service,bootstrap}
                ...
flowgate: error: unrecognized arguments: --litellm-version 1.2.3
ok
test_doctor_fails_when_api_key_ref_credential_file_missing (test_cli.CLITests.test_doctor_fails_when_api_key_ref_credential_file_missing) ... ok
test_doctor_passes_when_runtime_ready (test_cli.CLITests.test_doctor_passes_when_runtime_ready) ... ok
test_doctor_reports_cliproxyapiplus_update_when_available (test_cli.CLITests.test_doctor_reports_cliproxyapiplus_update_when_available) ... ok
test_doctor_reports_missing_runtime_artifacts (test_cli.CLITests.test_doctor_reports_missing_runtime_artifacts) ... ok
test_health_command (test_cli.CLITests.test_health_command) ... ok
test_health_command_fails_when_service_not_running (test_cli.CLITests.test_health_command_fails_when_service_not_running) ... ok
test_health_command_uses_default_readiness_path_when_missing (test_cli.CLITests.test_health_command_uses_default_readiness_path_when_missing) ... ok
test_integration_apply_claude_code (test_cli.CLITests.test_integration_apply_claude_code) ... ok
test_integration_print_claude_code (test_cli.CLITests.test_integration_print_claude_code) ... ok
test_integration_print_codex (test_cli.CLITests.test_integration_print_codex) ... ok
test_parser_prog_name_is_flowgate (test_cli.CLITests.test_parser_prog_name_is_flowgate) ... ok
test_profile_list_and_set (test_cli.CLITests.test_profile_list_and_set) ... ok
test_profile_set_restarts_litellm_when_running (test_cli.CLITests.test_profile_set_restarts_litellm_when_running) ... ok
test_service_restart_reports_port_in_use_when_service_not_running (test_cli.CLITests.test_service_restart_reports_port_in_use_when_service_not_running) ... ok
test_service_start_reports_cliproxyapiplus_update_when_available (test_cli.CLITests.test_service_start_reports_cliproxyapiplus_update_when_available) ... ok
test_service_start_reports_port_in_use (test_cli.CLITests.test_service_start_reports_port_in_use) ... ok
test_service_start_stop_all (test_cli.CLITests.test_service_start_stop_all) ... ok
test_status_command (test_cli.CLITests.test_status_command) ... ok
test_status_detects_default_auth_dir_permission_issues (test_cli.CLITests.test_status_detects_default_auth_dir_permission_issues) ... ok
test_auth_import_headless_invalid_json_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_import_headless_invalid_json_exit_code)
auth import-headless returns exit code 1 when JSON file is invalid ... ok
test_auth_import_headless_missing_source_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_import_headless_missing_source_exit_code)
auth import-headless returns exit code 1 when source file is missing ... ok
test_auth_import_headless_unsupported_provider_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_import_headless_unsupported_provider_exit_code)
auth import-headless returns exit code 2 when provider is unsupported ... ok
test_auth_list_missing_config_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_list_missing_config_exit_code)
auth list returns non-zero exit code when config file is missing ... ok
test_auth_list_success_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_list_success_exit_code)
auth list returns exit code 0 on success ... ok
test_auth_login_invalid_provider_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_login_invalid_provider_exit_code)
auth login returns exit code 2 when provider is invalid ... ok
test_auth_login_timeout_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_login_timeout_exit_code)
auth login returns exit code 1 on timeout ... ok
test_auth_status_success_exit_code (test_cli_regression_auth.TestAuthCommandExitCodes.test_auth_status_success_exit_code)
auth status returns exit code 0 on success (even when no auth exists) ... ok
test_auth_import_headless_success_output_format (test_cli_regression_auth.TestAuthCommandOutput.test_auth_import_headless_success_output_format)
auth import-headless success output includes saved_auth path ... ok
test_auth_list_empty_providers_output (test_cli_regression_auth.TestAuthCommandOutput.test_auth_list_empty_providers_output)
auth list output format when no providers are configured ... ok
test_auth_list_output_format (test_cli_regression_auth.TestAuthCommandOutput.test_auth_list_output_format)
auth list output includes providers and capability information ... ok
test_auth_login_error_output_contains_hint (test_cli_regression_auth.TestAuthCommandOutput.test_auth_login_error_output_contains_hint)
auth login error output includes debugging hint ... ok
test_auth_login_success_output_format (test_cli_regression_auth.TestAuthCommandOutput.test_auth_login_success_output_format)
auth login success output includes login_url and oauth_status ... ok
test_auth_status_output_format (test_cli_regression_auth.TestAuthCommandOutput.test_auth_status_output_format)
auth status output includes default_auth_dir and provider information ... ok
test_doctor_missing_binaries (test_cli_regression_misc.TestDiagnosticCommandRegression.test_doctor_missing_binaries)
doctor command fails when runtime binaries are missing ... ok
test_doctor_runtime_exists (test_cli_regression_misc.TestDiagnosticCommandRegression.test_doctor_runtime_exists)
doctor command checks runtime directory and binaries ... ok
test_health_all_services_healthy (test_cli_regression_misc.TestDiagnosticCommandRegression.test_health_all_services_healthy)
health command returns exit code 0 when all services are healthy ... ok
test_health_service_down_returns_nonzero (test_cli_regression_misc.TestDiagnosticCommandRegression.test_health_service_down_returns_nonzero)
health command returns exit code 1 when services are not running ... ok
test_status_success (test_cli_regression_misc.TestDiagnosticCommandRegression.test_status_success)
status command returns exit code 0 and displays service status ... ok
test_profile_list_success (test_cli_regression_misc.TestProfileCommandRegression.test_profile_list_success)
profile list returns exit code 0 and lists all profiles ... ok
test_profile_set_invalid_returns_nonzero (test_cli_regression_misc.TestProfileCommandRegression.test_profile_set_invalid_returns_nonzero)
profile set with nonexistent profile returns exit code 2 ... ok
test_profile_set_success (test_cli_regression_misc.TestProfileCommandRegression.test_profile_set_success)
profile set switches to a valid profile and returns exit code 0 ... ok
test_profile_set_with_litellm_running_restarts_service (test_cli_regression_misc.TestProfileCommandRegression.test_profile_set_with_litellm_running_restarts_service)
profile set restarts LiteLLM if it's already running ... ok
test_status_shows_current_profile (test_cli_regression_misc.TestProfileCommandRegression.test_status_shows_current_profile)
status command displays current profile from state file ... ok
test_service_missing_command_argument_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_missing_command_argument_exit_code)
service command without action argument shows usage and returns error ... usage: flowgate service [-h] {start,stop,restart} ...
flowgate service: error: the following arguments are required: service_cmd
ok
test_service_restart_invalid_service_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_restart_invalid_service_exit_code)
service restart returns exit code 2 when service name is invalid ... ok
test_service_start_invalid_service_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_start_invalid_service_exit_code)
service start returns exit code 2 when service name is invalid ... ok
test_service_start_port_conflict_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_start_port_conflict_exit_code)
service start returns exit code 1 when port is already in use ... ok
test_service_stop_invalid_service_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_stop_invalid_service_exit_code)
service stop returns exit code 2 when service name is invalid ... ok
test_service_stop_not_running_exit_code (test_cli_regression_service.TestServiceCommandExitCodes.test_service_stop_not_running_exit_code)
service stop returns exit code 0 when service is not running (idempotent) ... ok
test_service_port_conflict_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_port_conflict_output_format)
service start port conflict output includes port and host information ... ok
test_service_restart_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_restart_output_format)
service restart output includes service name and PID ... ok
test_service_start_all_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_start_all_output_format)
service start all output includes all configured services ... ok
test_service_start_success_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_start_success_output_format)
service start success output includes service name and PID ... ok
test_service_stop_failure_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_stop_failure_output_format)
service stop failure output includes service name and stop-failed status ... ok
test_service_stop_success_output_format (test_cli_regression_service.TestServiceCommandOutput.test_service_stop_success_output_format)
service stop success output includes service name and stopped status ... ok
test_apply_claude_creates_backup_and_merges_managed_env_keys (test_client_apply.ClientApplyTests.test_apply_claude_creates_backup_and_merges_managed_env_keys) ... ok
test_apply_codex_updates_active_provider_base_url_and_preserves_other_sections (test_client_apply.ClientApplyTests.test_apply_codex_updates_active_provider_base_url_and_preserves_other_sections) ... ok
test_management_api_url_follows_auth_endpoint_base (test_cliproxy_debug.CliproxyDebugTests.test_management_api_url_follows_auth_endpoint_base) ... ok
test_management_page_url_uses_root_path (test_cliproxy_debug.CliproxyDebugTests.test_management_page_url_uses_root_path) ... ok
test_defaults_config_version_to_2 (test_config.ConfigTests.test_defaults_config_version_to_2) ... ok
test_load_auth_providers_new_schema (test_config.ConfigTests.test_load_auth_providers_new_schema) ... ok
test_load_credentials_schema (test_config.ConfigTests.test_load_credentials_schema) ... ok
test_load_valid_config (test_config.ConfigTests.test_load_valid_config) ... ok
test_merge_dicts_deep (test_config.ConfigTests.test_merge_dicts_deep) ... ok
test_migrates_legacy_cliproxyapi_service_name (test_config.ConfigTests.test_migrates_legacy_cliproxyapi_service_name) ... ok
test_migrates_legacy_secrets_key (test_config.ConfigTests.test_migrates_legacy_secrets_key) ... ok
test_reject_unknown_top_level_key (test_config.ConfigTests.test_reject_unknown_top_level_key) ... ok
test_rejects_invalid_credentials_schema (test_config.ConfigTests.test_rejects_invalid_credentials_schema) ... ok
test_rejects_unsupported_config_version (test_config.ConfigTests.test_rejects_unsupported_config_version) ... ok
test_example_cliproxyapi_port_matches_constants (test_defaults_sync.DefaultsSyncTests.test_example_cliproxyapi_port_matches_constants) ... ok
test_example_flowgate_services_match_constants (test_defaults_sync.DefaultsSyncTests.test_example_flowgate_services_match_constants) ... ok
test_example_flowgate_urls_use_cliproxy_port (test_defaults_sync.DefaultsSyncTests.test_example_flowgate_urls_use_cliproxy_port) ... ok
test_smoke_script_has_claude_messages_probe (test_dev_scripts.DevScriptTests.test_smoke_script_has_claude_messages_probe) ... ok
test_xgate_wraps_uvx_flowgate (test_dev_scripts.DevScriptTests.test_xgate_wraps_uvx_flowgate) ... ok
test_xtest_wraps_uvx_unittest (test_dev_scripts.DevScriptTests.test_xtest_wraps_uvx_unittest) ... ok
test_integration_doc_mentions_claude_gateway_support (test_docs_integration.IntegrationDocsTests.test_integration_doc_mentions_claude_gateway_support) ... ok
test_import_codex_headless_auth (test_headless_import.HeadlessImportTests.test_import_codex_headless_auth) ... ok
test_import_rejects_missing_tokens (test_headless_import.HeadlessImportTests.test_import_rejects_missing_tokens) ... ok
test_build_integration_specs_defaults_fast_model_to_default_model (test_integration.IntegrationSpecTests.test_build_integration_specs_defaults_fast_model_to_default_model) ... ok
test_build_integration_specs_from_litellm_service (test_integration.IntegrationSpecTests.test_build_integration_specs_from_litellm_service) ... ok
test_switch_profile_updates_active_config (test_integration_profile_switch.ProfileSwitchIntegrationTests.test_switch_profile_updates_active_config) ... ok
test_fetch_auth_url (test_oauth.OAuthTests.test_fetch_auth_url) ... ok
test_poll_auth_status_success (test_oauth.OAuthTests.test_poll_auth_status_success) ... ok
test_poll_auth_status_tolerates_transient_network_error (test_oauth.OAuthTests.test_poll_auth_status_tolerates_transient_network_error) ... ok
test_pre_commit_config_includes_standard_and_ruff_hooks (test_precommit_config.PreCommitConfigTests.test_pre_commit_config_includes_standard_and_ruff_hooks) ... ok
test_health_check_handles_network_error (test_process.ProcessSupervisorTests.test_health_check_handles_network_error) ... ok
test_start_and_stop_long_running_process (test_process.ProcessSupervisorTests.test_start_and_stop_long_running_process) ... ok
test_activate_profile_rejects_unknown_api_key_ref (test_profile.ProfileActivationTests.test_activate_profile_rejects_unknown_api_key_ref) ... ok
test_activate_profile_resolves_api_key_ref_to_api_key (test_profile.ProfileActivationTests.test_activate_profile_resolves_api_key_ref_to_api_key) ... ok
test_activate_profile_writes_active_config_and_state (test_profile.ProfileActivationTests.test_activate_profile_writes_active_config_and_state) ... ok
test_reports_insecure_secret_permissions (test_security.SecurityTests.test_reports_insecure_secret_permissions) ... ok

----------------------------------------------------------------------
Ran 110 tests in 2.551s

OK
